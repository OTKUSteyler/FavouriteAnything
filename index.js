(function(h,s){"use strict";let u=null,a=null;function p(){if(u)return u;try{u=s.findByProps("addToFavorites","removeFromFavorites")}catch(r){console.warn("[FavouriteAnything] Could not find favourites API:",r)}return u}function v(){if(a)return a;try{a=s.findByProps("markAsUnread","suppressEmbeds")}catch(r){console.warn("[FavouriteAnything] Could not find MessageActions module:",r)}return a}const y={IMAGE:1,VIDEO:2};function g(r){if(!r)return null;if(Array.isArray(r.attachments))for(const o of r.attachments){const t=(o.content_type||"").split(";")[0];if(t.startsWith("image/")||t.startsWith("video/"))return{url:o.url,proxyURL:o.proxy_url||o.url,width:o.width||0,height:o.height||0,isVideo:t.startsWith("video/")}}if(Array.isArray(r.embeds))for(const o of r.embeds){if(o.type==="gifv"&&o.video)return{url:o.url||o.video.url,proxyURL:o.video.proxy_url||o.video.url||o.url,width:o.video.width||0,height:o.video.height||0,isVideo:!0};if(o.video)return{url:o.video.url,proxyURL:o.video.proxy_url||o.video.url,width:o.video.width||0,height:o.video.height||0,isVideo:!0};if(o.image)return{url:o.image.url,proxyURL:o.image.proxy_url||o.image.url,width:o.image.width||0,height:o.image.height||0,isVideo:!1}}return null}function f(r){return{key:"favouriteAnything",label:"\u2B50 Favourite",onPress:function(){const o=p();if(o&&typeof o.addToFavorites=="function")try{o.addToFavorites({src:r.proxyURL,url:r.url,width:r.width,height:r.height,format:r.isVideo?y.VIDEO:y.IMAGE});const{showToast:t}=s.findByProps("showToast")||{};t&&t("Added to Favourites \u2B50",1)}catch(t){console.error("[FavouriteAnything] addToFavorites threw:",t);const{showToast:n}=s.findByProps("showToast")||{};n&&n("Failed to favourite \u2014 check console.",2)}else{const{showToast:t}=s.findByProps("showToast")||{};t&&t("Favourites API unavailable on this Discord build.",2)}}}}let l=null;function A(){const r=v();if(!r){console.error("[FavouriteAnything] MessageActions module not found yet. Long-press any message once, then re-enable the plugin.");return}const{patcher:o}=window.bunny||{};if(!o){console.error("[FavouriteAnything] Patcher not available!");return}const t=["getActions","buildActions","default"];let n=null;for(const i of t)if(typeof r[i]=="function"){n=i;break}if(!n){console.error("[FavouriteAnything] No patchable function found on MessageActions. Available keys:",Object.keys(r));return}l=o.after(n,r,function(i,e){const F=i[0]&&i[0].message||i[0]||null,d=g(F);if(!d)return e;if(Array.isArray(e))return e.push(f(d)),e;if(e&&e.props){if(Array.isArray(e.props.options))return e.props.options.push(f(d)),e;if(Array.isArray(e.props.children)){for(const c of e.props.children)if(c&&c.props&&Array.isArray(c.props.options))return c.props.options.push(f(d)),e}}return console.warn("[FavouriteAnything] Could not locate options array. Return-value shape:",e),e})}var w={onLoad:function(){A(),console.log("[FavouriteAnything] Enabled")},onUnload:function(){typeof l=="function"&&(l(),l=null),u=null,a=null,console.log("[FavouriteAnything] Disabled")}};return h.default=w,Object.defineProperty(h,"__esModule",{value:!0}),h})({},vendetta.metro);
