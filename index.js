(function(){"use strict";const{findByProps:u,findByDisplayName:x}=require("@vendetta/metro-modules"),{patcher:c}=require("@vendetta/patcher"),{Share:d,ToastAndroid:i,Platform:y}=require("react-native");function h(){const r=["getMessageActions","messageActions","buildMessageActions","MessageActions"];for(const o of r)try{const e=u(o);if(e)return{module:e,key:o}}catch{}return null}function p(){try{return u("addToFavorites")}catch{return null}}function f(r){const o=[];if(Array.isArray(r?.attachments))for(const e of r.attachments){const n=(e.content_type||e.contentType||"").toLowerCase();n.startsWith("image/")?o.push({url:e.url,proxyUrl:e.proxy_url||e.proxyURL||e.url,isVideo:!1}):n.startsWith("video/")&&o.push({url:e.url,proxyUrl:e.proxy_url||e.proxyURL||e.url,isVideo:!0})}if(Array.isArray(r?.embeds))for(const e of r.embeds)e.type==="gifv"&&e.video&&o.push({url:e.url||e.video.url,proxyUrl:e.video.proxy_url||e.video.proxyURL||e.video.url,isVideo:!0}),e.image&&o.push({url:e.image.url,proxyUrl:e.image.proxy_url||e.image.proxyURL||e.image.url,isVideo:!1}),e.video&&e.type!=="gifv"&&o.push({url:e.video.url,proxyUrl:e.video.proxy_url||e.video.proxyURL||e.video.url,isVideo:!0});return o}async function g(r){if(!r||r.length===0)return;const o=r[0],e=p();if(e&&typeof e.addToFavorites=="function")try{e.addToFavorites({src:o.proxyUrl||o.url,url:o.url,format:o.isVideo?2:1}),v("Added to favourites \u2B50");return}catch(n){console.warn("[FavouriteAnything] addToFavorites threw:",n)}try{await d.open({message:o.url,title:"Save media"})}catch(n){console.warn("[FavouriteAnything] Share.open cancelled or failed:",n)}}function v(r){y.OS==="android"&&i.showWithGravity(r,i.SHORT,i.BOTTOM)}let a=[];module.exports={name:"FavouriteAnything",description:"Adds a \u2B50 Favourite button to the long-press menu on any message containing an image or video",authors:[{name:"nin0"},{name:"Davri",id:457579346282938368n}],onEnable(){const r=h();if(!r){console.error(`[FavouriteAnything] Could not find the message-actions module.
Install the 'ActionSheetFinder' dev plugin, long-press a message,
and check the log to discover the current module key \u2014 then update
the candidates list in findMessageActionsModule().`);return}const{module:o,key:e}=r;console.log("[FavouriteAnything] Patching module key:",e);const n=c.after(e,o,function(m,t){const A=m[0],l=f(A);if(l.length===0)return t;const s={label:"\u2B50 Favourite",onPress:function(){return g(l)}};return Array.isArray(t)?t.push(s):t&&Array.isArray(t.items)?t.items.push(s):t&&Array.isArray(t.actions)&&t.actions.push(s),t});a.push(n),console.log("[FavouriteAnything] Enabled \u2B50")},onDisable(){a.forEach(function(r){try{r()}catch(o){console.warn("[FavouriteAnything] cleanup error:",o)}}),a=[],console.log("[FavouriteAnything] Disabled")}}})();
